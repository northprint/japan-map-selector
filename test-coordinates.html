<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>座標テスト</title>
</head>
<body>
  <h1>座標構造のテスト</h1>
  <pre id="output"></pre>
  
  <script type="module">
    const output = document.getElementById('output');
    
    // 都道府県データを確認
    const prefResponse = await fetch('./src/data/prefectures.geojson');
    const prefData = await prefResponse.json();
    
    const firstPref = prefData.features[0];
    output.textContent += `都道府県: ${firstPref.properties.N03_001}\n`;
    output.textContent += `Geometry type: ${firstPref.geometry.type}\n`;
    
    // MultiPolygonの構造を詳しく確認
    const coords = firstPref.geometry.coordinates;
    output.textContent += `\nMultiPolygon構造:\n`;
    output.textContent += `- 最上位配列の長さ: ${coords.length}\n`;
    output.textContent += `- 最初のPolygonの長さ: ${coords[0].length}\n`;
    output.textContent += `- 最初のRingの長さ: ${coords[0][0].length}\n`;
    output.textContent += `- 最初の3つの座標:\n`;
    
    for (let i = 0; i < Math.min(3, coords[0][0].length); i++) {
      const coord = coords[0][0][i];
      output.textContent += `  [${i}]: ${JSON.stringify(coord)}\n`;
      output.textContent += `    型: ${typeof coord}, 配列: ${Array.isArray(coord)}\n`;
      if (Array.isArray(coord)) {
        output.textContent += `    lng: ${coord[0]} (${typeof coord[0]}), lat: ${coord[1]} (${typeof coord[1]})\n`;
      }
    }
    
    // 投影テスト
    output.textContent += '\n投影計算テスト:\n';
    const module = await import('./dist/index.es.js');
    const { mercatorProjection, getDefaultProjection } = module;
    
    const projection = getDefaultProjection();
    const testCoord = coords[0][0][0];
    output.textContent += `テスト座標: ${JSON.stringify(testCoord)}\n`;
    
    const [x, y] = mercatorProjection(testCoord[0], testCoord[1], projection);
    output.textContent += `投影結果: [${x}, ${y}]\n`;
    
    // 計算の詳細
    output.textContent += '\n計算の詳細:\n';
    output.textContent += `longitude: ${testCoord[0]}\n`;
    output.textContent += `latitude: ${testCoord[1]}\n`;
    output.textContent += `center: ${JSON.stringify(projection.center)}\n`;
    output.textContent += `scale: ${projection.scale}\n`;
    output.textContent += `translateX: ${projection.translateX}\n`;
    output.textContent += `translateY: ${projection.translateY}\n`;
    
    const xCalc = (testCoord[0] - projection.center[0]) * projection.scale + projection.translateX;
    const yCalc = (-testCoord[1] + projection.center[1]) * projection.scale + projection.translateY;
    output.textContent += `x計算: (${testCoord[0]} - ${projection.center[0]}) * ${projection.scale} + ${projection.translateX} = ${xCalc}\n`;
    output.textContent += `y計算: (-${testCoord[1]} + ${projection.center[1]}) * ${projection.scale} + ${projection.translateY} = ${yCalc}\n`;
  </script>
</body>
</html>