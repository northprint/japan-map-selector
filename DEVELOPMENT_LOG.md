# 開発ログ

## プロジェクト概要

日本の都道府県・市区町村を選択できるインタラクティブな地図コンポーネントの開発記録。

## 実装した主な機能

### 1. 基本機能
- ✅ TypeScriptによるモジュール開発
- ✅ 都道府県の表示と選択
- ✅ 市区町村の表示と選択
- ✅ React/Svelteラッパーの実装
- ✅ GeoJSONデータの読み込みと解析

### 2. 地図表示の改善
- ✅ 沖縄県の特別表示（左上に別枠で配置）
- ✅ 離島のフィルタリング（全国表示時）
- ✅ 東京都の離島切り替えボタン
- ✅ 適切な投影とスケーリング

### 3. インタラクション
- ✅ マウスホバーでのハイライト
- ✅ クリックでの選択
- ✅ ツールチップ表示
- ✅ カーソルの変更（pointer/grab/grabbing）

### 4. WebGIS機能
- ✅ ズームボタン（+/-）
- ✅ マウスホイールでのズーム
- ✅ ドラッグでのパン（地図移動）
- ✅ スムーズなアニメーション
- ✅ ズームレベルの制限

## 解決した主な課題

### データ取得
- GitHub APIを使用して正しいデータパスを特定
- 都道府県コードの自動生成

### 表示の問題
- 北海道が画面外に出る → スケール調整
- 沖縄県が表示されない → 特別な配置ロジック
- 東京都の離島で本土が選択できない → フィルタリング機能
- 新潟県が消える → 佐渡島は残すように調整

### ユーザビリティ
- ズーム中に他の県に入ってしまう → 自動ズーム機能を削除
- ホバーでビューがリセットされる → 選択時のみビューボックスを更新
- ドラッグ中の誤クリック → ドラッグ中はクリックを無視

## 技術的な工夫

### 1. フレームワーク非依存の設計
```typescript
// コアロジックは純粋なTypeScript
class JapanMapSelector {
  // フレームワークに依存しない実装
}

// フレームワーク用ラッパー
export function JapanMapSelectorReact(props) {
  // Reactコンポーネントとしてラップ
}
```

### 2. 効率的なレンダリング
- SVGパスの事前計算
- イベントデリゲーション
- 必要な時のみDOM更新

### 3. 座標変換
- メルカトル投影（簡易版）の実装
- 動的なビューボックス計算
- マウス座標とSVG座標の変換

## 今後の改善案

1. パフォーマンス最適化
   - 市区町村データの遅延読み込み
   - WebWorkerでのデータ処理

2. 機能追加
   - 検索機能
   - 選択履歴
   - データの可視化（人口、統計など）

3. アクセシビリティ
   - キーボード操作
   - スクリーンリーダー対応
   - 高コントラストモード

## 使用したデータ

- [smartnews-smri/japan-topography](https://github.com/smartnews-smri/japan-topography)
  - 簡略化された都道府県・市区町村ポリゴンデータ
  - GeoJSON形式

## 開発環境

- TypeScript 4.x
- Rollup（バンドラー）
- React 18（オプション）
- Svelte 3（オプション）

最終更新: 2025-06-15