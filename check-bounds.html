<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>境界チェック</title>
  <style>
    body { margin: 20px; font-family: sans-serif; }
    table { border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f0f0f0; }
    .highlight { background: #ffffcc; }
  </style>
</head>
<body>
  <h1>都道府県の境界チェック</h1>
  <div id="summary"></div>
  <table>
    <thead>
      <tr>
        <th>都道府県</th>
        <th>西端</th>
        <th>東端</th>
        <th>南端</th>
        <th>北端</th>
        <th>幅</th>
        <th>高さ</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
  
  <script type="module">
    const module = await import('./dist/index.es.js');
    const { JapanMapSelector } = module;
    
    const selector = new JapanMapSelector();
    await selector.initialize(
      './src/data/prefectures.geojson',
      './src/data/municipalities.geojson'
    );
    
    const prefectures = selector.getPrefectures();
    const tableBody = document.getElementById('tableBody');
    const summary = document.getElementById('summary');
    
    // 全体の境界を計算
    let minLng = Infinity, maxLng = -Infinity;
    let minLat = Infinity, maxLat = -Infinity;
    let easternmost = null;
    let westernmost = null;
    let northernmost = null;
    let southernmost = null;
    
    // データを整理
    const data = prefectures.map(pref => {
      const [[west, south], [east, north]] = pref.bounds;
      
      // 全体の境界更新
      if (west < minLng) { minLng = west; westernmost = pref.name; }
      if (east > maxLng) { maxLng = east; easternmost = pref.name; }
      if (south < minLat) { minLat = south; southernmost = pref.name; }
      if (north > maxLat) { maxLat = north; northernmost = pref.name; }
      
      return {
        name: pref.name,
        west, east, south, north,
        width: east - west,
        height: north - south
      };
    });
    
    // 東端でソート
    data.sort((a, b) => b.east - a.east);
    
    // サマリー表示
    summary.innerHTML = `
      <h2>日本の境界</h2>
      <p>最西端: ${minLng.toFixed(2)}° (${westernmost})</p>
      <p class="highlight">最東端: ${maxLng.toFixed(2)}° (${easternmost})</p>
      <p>最南端: ${minLat.toFixed(2)}° (${southernmost})</p>
      <p>最北端: ${maxLat.toFixed(2)}° (${northernmost})</p>
      <p>全体の幅: ${(maxLng - minLng).toFixed(2)}°</p>
      <p>全体の高さ: ${(maxLat - minLat).toFixed(2)}°</p>
      
      <h3>最も東にある都道府県TOP5</h3>
    `;
    
    // 表に表示（東端TOP10）
    data.slice(0, 10).forEach((pref, index) => {
      const row = tableBody.insertRow();
      if (index === 0) row.className = 'highlight';
      
      row.insertCell(0).textContent = pref.name;
      row.insertCell(1).textContent = pref.west.toFixed(2);
      row.insertCell(2).textContent = pref.east.toFixed(2);
      row.insertCell(3).textContent = pref.south.toFixed(2);
      row.insertCell(4).textContent = pref.north.toFixed(2);
      row.insertCell(5).textContent = pref.width.toFixed(2);
      row.insertCell(6).textContent = pref.height.toFixed(2);
    });
    
    // 沖縄を除いた境界も計算
    let mainMinLng = Infinity, mainMaxLng = -Infinity;
    let mainMinLat = Infinity, mainMaxLat = -Infinity;
    
    prefectures.forEach(pref => {
      if (pref.name !== '沖縄県') {
        const [[west, south], [east, north]] = pref.bounds;
        mainMinLng = Math.min(mainMinLng, west);
        mainMaxLng = Math.max(mainMaxLng, east);
        mainMinLat = Math.min(mainMinLat, south);
        mainMaxLat = Math.max(mainMaxLat, north);
      }
    });
    
    summary.innerHTML += `
      <h3>沖縄県を除いた境界</h3>
      <p>西端: ${mainMinLng.toFixed(2)}°</p>
      <p>東端: ${mainMaxLng.toFixed(2)}°</p>
      <p>幅: ${(mainMaxLng - mainMinLng).toFixed(2)}°</p>
    `;
  </script>
</body>
</html>